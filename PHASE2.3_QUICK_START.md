# 🎮 Phase 2.3 快速使用指南

## 📱 新增功能速览

Phase 2.3 在原有基础上增加了 **点位管理** 的完整交互体验，让用户可以：
- 👁️ 查看所有已添加的点位
- 🔄 重命名点位（改名称）
- 🗑️ 删除点位（从地图删除）
- ☑️ 多选终点（选择要显示的连线）

---

## 🎯 基础操作流程

### 1️⃣ **添加점位**（基础操作）

```
步骤：
1. 在 MapScreen 右侧找到按钮区
2. 点击 "加原点" → 在当前 GPS 位置添加原点
   或 点击 "加终点" → 在当前 GPS 位置添加终点
3. 点位自动显示在笑脸
4. 数据自动保存
```

**预期结果：**
- ✅ 按钮按下后立即显示"Added marker"日志（Mock模式）
- ✅ 左上角"点位列表"更新，显示新增的点位
- ✅ 如果是第二个点位，原点和终点会自动连线

---

### 2️⃣ **查看点位列表**（新增）

```
步骤：
1. 看到左上角的卡片："点位列表 (1)"
   （数字表示当前有多少个点位）
2. 点击卡片任何地方展开列表 ⬇️
3. 看到所有点位：
   [原] 点位名称
   纬: XX.XXXX, 经: XX.XXXX
   
4. 再点击任何地方收起列表 ⬆️
```

**预期结果：**
- ✅ 卡片有平滑的展开/收起动画
- ✅ 看到所有点位的名称和坐标
- ✅ 原点显示绿色"原"标签，终点显示蓝色"终"标签

---

### 3️⃣ **重命名点位**（新增）

```
步骤：
1. 打开左上角的"点位列表"卡片
2. 在任意点位上执行长按（按住、不放手）
   → 点位背景变红，出现两个按钮
3. 点击橙色的 "重命名" 按钮
4. 弹出 AlertDialog
5. 清空输入框，输入新名称（如"大门"）
6. 点击 "确认" 按钮
7. 列表更新，点位名称已改

成功！✅
```

**技巧：**
- 如果长按后没有显示按钮，试试长按点位名称部分
- 可以输入中文、数字、英文的任意组合
- 点位坐标不会改变，只是名称改了

**预期结果：**
- ✅ Dialog 弹出，显示当前的点位名称
- ✅ 输入新名称后，数据库自动保存
- ✅ 列表即时刷新，显示新名称

---

### 4️⃣ **删除点位**（新增）

```
步骤：
1. 打开左上角的"点位列表"卡片
2. 在要删除的点位上长按
   → 背景变红，出现两个按钮
3. 点击红色的 "删除" 按钮
4. 点位被删除，列表更新

成功！✅
```

**注意事项：**
- ❌ 删除后**无法撤销**，请确认后再删
- ✅ 删除原点后，所有连线也会被清空
- ✅ 删除终点后，相应的连线被移除

**预期结果：**
- ✅ 点击删除后立即从列表消失
- ✅ 如果有连线显示，面板会自动关闭
- ✅ 数据库自动更新

---

### 5️⃣ **多选终点**（新增 - 进阶功能）

```
工作流程：
1. 添加 1 个原点 + 多个终点（2个或以上）
2. 在右侧按钮区找到 "管理终点（2）" 按钮
   （括号内的数字是当前终点个数）
3. 点击该按钮 → 弹出"选择终点"对话框
4. 对话框显示所有终点的列表，每个都有 Checkbox
5. 取消选中某些终点（✓ 变 ✗）
6. 点击 "确认" 按钮
7. 未选中的终点被移除，只保留选中的

成功！✅
```

**场景示例：**
```
我有3个终点：[A] [B] [C]

现在我想只看 A 和 C 的连线，不看 B 的：

1. 打开"管理终点（3）"
2. 在 B 的 Checkbox 点击一下 → 取消选中
3. 现在显示：A ✓, B ☐, C ✓
4. 点击 "确认"
5. B 被删除，之后只能看 A 和 C 的连线
```

**预期结果：**
- ✅ Dialog 显示所有终点列表
- ✅ 选中的终点显示蓝色对勾 ✓
- ✅ 确认后，未选中的终点被隐藏或删除

---

## 🔥 完整工作流示例

### 场景：我想分析从"公司"到"三个商圈"的堪舆

```
【第 1 步】添加原点（公司位置）
→ 点击 "加原点"
→ 左上角列表显示：[原] 原点

【第 2 步】添加三个终点（商圈）
→ 点击 "加终点" 3 次
→ 列表更新显示：
   [原] 原点
   [终] 终点
   [终] 终点
   [终] 终点

【第 3 步】查看其中一个连线的堪舆数据
→ 点击 "显示连线信息"
→ 底部出现数据面板，显示：
   - 方位角（如 45°）
   - 24山（如"巽山"）
   - 八卦（如"巽卦"）
   - 五行（如"木"）
   - 距离（如 2.5km）

【第 4 步】临时删除其中一个终点
→ 左上角"点位列表"长按某个终点
→ 点击 "删除"
→ 该终点消失，其他保留

【第 5 步】恢复被删的终点
→ 点击 "加终点" 重新添加
→ 重新选择位置

【第 6 步】多选管理
→ 现在有原点 + 3个终点
→ 点击 "管理终点（3）"
→ 只选中其中 2 个
→ 第 3 个被过滤掉
```

---

## ⚙️ 常见问题

### Q1: 长按点位没有显示按钮怎么办？
**A:** 
- 试试按住点位区域的名称部分（粗体字）
- 确保点击时间足够长（约 0.5 秒）
- 如果还是不行，可能是屏幕触发延迟，试试在其他地方长按

### Q2: 删除了点位怎么恢复？
**A:** 
❌ **无法恢复**，所有操作实时保存。  
👉 建议重新添加该点位

### Q3: 为什么删除了原点但地图上的标记还在？
**A:** 
- 这是 Mock 模式的限制（不连接实际地图）
- 切换到真实 Google Maps 后会正常删除标记
- Mock 模式只在数据库删除，视觉更新可能有延迟

### Q4: "管理终点"按钮在哪里？
**A:** 
- 在屏幕右侧的按钮柱
- **前提条件**：必须同时有 1 个原点 + 至少 1 个终点
- 按钮显示为 "管理终点（N）"，其中 N 是当前终点数

### Q5: 能否同时有多个原点？
**A:** 
当前 Phase 2.3：**只支持单个原点**  
预计 Phase 3：支持多个原点和切换

---

## 💾 数据持久化

所有操作都自动保存到本地数据库（SharedPreferences）：

| 操作 | 自动保存 | 销毁应用后 |
|------|---------|----------|
| 添加点位 | ✅ 即时 | ✅ 仍存在 |
| 重命名点位 | ✅ 即时 | ✅ 保持新名称 |
| 删除点位 | ✅ 即时 | ✅ 消失 |
| 多选终点 | ✅ 即时 | ✅ 保持选中状态 |

**重启应用后，所有点位和操作都会还原。** ✅

---

## 🧪 测试清单

在编译运行后，建议按顺序测试以下功能：

```
[ ] 1. 添加第一个原点 → 看到列表更新
[ ] 2. 添加第一个终点 → 看到"显示连线信息"按钮出现
[ ] 3. 点击"管理终点" → 看到多选对话框
[ ] 4. 取消选中某个终点 → 点击确认
[ ] 5. 再添加第二个终点 → 列表中有两个终点项
[ ] 6. 长按其中一个点位 → 背景变红，显示操作按钮
[ ] 7. 点击"重命名" → 输入新名称 → 确认
[ ] 8. 点击"删除" → 该点位消失
[ ] 9. 点击"显示连线信息" → 看到数据面板展开
[ ] 10. 关闭应用，重启 → 所有点位和改名都被保留
```

**全部通过：** ✅ Phase 2.3 开发完成！

---

## 🚀 下一步建议

现在 Phase 2.3 完成了，你可以：

### 选项 A：继续测试（推荐）
```
1. 在 Android Studio 中编译: Build → Make Project
2. 运行应用: Run → Run 'app'
3. 用上面的"测试清单"逐项验证
4. 观察 LogCat 中的 "MockMapProvider" 日志
5. 尝试各种操作组合
```

### 选项 B：进入 Phase 3（多案例管理）
```
Phase 3 会实现：
- 底部 Tab 栏导航
- 多案例切换
- 案例列表管理 (创建/编辑/删除)
- 原点多选切换
```

### 选项 C：配置真实 Google Maps
```
改进用 Mock Map → 真实 Google Maps：
1. 在 Google Cloud Console 申请 API Key
2. 添加到 AndroidManifest.xml
3. 在 MainActivity.kt 改 useMockMap = false
4. 编译运行 → 看到真实地图
```

---

## 📞 快速参考

| 功能 | 位置 | 快捷键 |
|------|------|--------|
| 加原点 | 右侧按钮 | 点击"加原点" |
| 加终点 | 右侧按钮 | 点击"加终点" |
| 显示连线 | 右侧按钮 | 点击"显示连线信息" |
| 点位列表 | 左上角 | 点击展开 |
| 重命名 | 列表 | 长按 → "重命名" |
| 删除 | 列表 | 长按 → "删除" |
| 多选终点 | 右侧按钮 | 点击"管理终点（N）" |
| 罗盘 | 左下角 | 自动更新 |
| 数据面板 | 底部中心 | 自动展开 |

---

**🎉 Phase 2.3 已就绪！立即编译并测试吧！**

```bash
Build → Make Project ✅ BUILD SUCCESSFUL
Run → Run 'app' 🚀 应用启动
```

有任何问题，参考本指南第 "⚙️ 常见问题" 部分！
