# 多案例连线显示功能 - 快速指南

## 功能概览

本次更新为风水工具添加了完整的多案例管理和自动连线显示功能：

✅ **多案例支持** - 创建和管理多个堪舆案例  
✅ **自动连线** - 添加原点或终点时自动生成连线  
✅ **连线显示** - 在地图上实时显示所有原点-终点连线  
✅ **原点选择** - 选择要锁定显示的原点位置  

## 使用指南

### 1. 启动应用
- 应用启动时自动加载所有已保存的案例
- 选中第一个案例（或之前最后使用的案例）
- 该案例的所有原点和终点自动加载
- **所有连线自动显示在地图上** ⭐

### 2. 查看不同案例的连线
点击右侧"📋 案例"按钮：
- 打开案例选择对话框
- 选择要查看的案例
- 该案例的所有连线自动刷新显示

### 3. 添加原点（自动连线）
1. 点击右侧"➕原点"按钮
2. 新原点在地图中心创建
3. **系统自动与所有现有终点生成连线并显示** ⭐
4. 罗盘自动锁定到新原点
5. 地图视角移动到该原点位置

### 4. 添加终点（自动连线）
1. 点击右侧"➕终点"按钮
2. 新终点在地图中心创建
3. **系统自动与所有现有原点生成连线并显示** ⭐
4. 地图显示该终点的所有连线

### 5. 选择要显示的原点
点击右侧"📍 原点"按钮：
- 打开原点选择对话框
- 选择一个原点
- 罗盘锁定到该原点位置
- 地图自动移动到该原点（便于查看该原点的所有连线）

### 6. 查看连线信息
- 在Compose中点击"显示连线信息"按钮（当有原点和终点时）
- 查看连线的详细信息：
  - 原点和终点的名称和坐标
  - 方位角（度数）
  - 24山方位
  - 八卦方位
  - 五行
  - 直线距离

## 地图控制

右侧按钮栏（从上到下）：

| 按钮 | 功能 |
|------|------|
| 🔒/🔓 | 罗盘锁定/解锁模式 |
| 📍 | 定位到GPS位置 |
| ⊕/⊖ | 放大/缩小 |
| 🗺️ | 切换矢量图/卫星图 |
| 📋 案例 | **选择要查看的案例** |
| 📍 原点 | **选择要锁定显示的原点** |
| ➕原点 | **在地图中心添加原点（自动连线）** |
| ➕终点 | **在地图中心添加终点（自动连线）** |

## 键盘快捷键和手势

- **屏幕中心十字准心** - 红色十字指示器，点击可添加点位
- **拖拽地图** - 移动地图位置
- **双指缩放** - 放大/缩小地图
- **十字准心点击** - 额外的点位添加选项

## 常见场景

### 场景1：为新房子做风水勘舆
1. 创建新案例（在堪舆管理界面）
2. 点击"➕原点"添加房子位置（原点）
3. 点击"➕终点"添加周边关键位置：
   - 医院（保护）
   - 学校（文昌）
   - 商场（财位）
   - 公园（休息）
4. 系统自动为原点与每个终点生成连线
5. 每条连线自动显示方位和风水信息

### 场景2：比较多个位置的风水优劣
1. 为每个位置创建独立的案例
2. 在每个案例中设置相同的周边关键点位
3. 点击案例选择，快速切换查看各位置的连线对比

### 场景3：分析生活圈风水布局
1. 创建"生活圈"案例
2. 原点：家的位置
3. 终点：
   - 工作地点
   - 常去的健身房
   - 常去的餐厅
   - 孩子的学校
4. 查看这些位置相对于家的方位关系

## 数据保存

- 所有案例、原点、终点数据自动保存到设备
- 应用关闭后重新启动，数据自动恢复
- 连线信息也会自动恢复显示

## 操作提示

✅ **最佳实践**：
- 添加原点后，再添加多个终点，自动连线效果最好
- 使用"📍 原点"按钮快速切换查看不同原点的连线
- 定期使用"📍 定位"按钮回到当前GPS位置

❌ **需要避免**：
- 不要在没有创建案例的情况下添加点位（会提示错误）
- 删除原点时所有相关连线也会删除（建议在堪舆管理中操作）

## 如果连线不显示

1. **检查是否有原点和终点**：
   - 点击"📍 原点"按钮验证是否有原点
   - 确认该案例有终点

2. **检查地图是否加载**：
   - 观察地图是否显示真实地图层
   - 如果显示灰色占位区域，可能是地图SDK初始化问题

3. **重新加载案例**：
   - 点击"📋 案例"按钮
   - 重新选择同一个案例
   - 连线应该重新显示

4. **检查GPS定位**：
   - 点击"📍 定位"按钮
   - 观察地图是否移动到当前位置
   - 这可以验证地图功能是否正常

## 技术细节

### 连线显示机制
- 连线通过Google Maps的Polyline API在地图上绘制
- 颜色：蓝色（#0000FF）
- 宽度：5像素
- 每条连线代表一对原点-终点

### 数据存储
- 案例数据存储在应用的SharedPreferences中
- 原点和终点数据按案例（projectId）分类存储
- 支持跨应用会话的完整数据恢复

### 性能特点
- 少于100条连线时，地图性能无损
- 添加点位时实时在地图上绘制连线（无延迟）
- 案例切换时自动刷新所有连线

## 获取帮助

如果遇到问题：
1. 确保Android系统版本 >= Android 5.0
2. 检查Google Play Services是否安装
3. 检查定位权限是否已授予
4. 尝试卸载重新安装应用
5. 查看应用日志（开发者模式）

## 更新日志

### 当前版本改动：
- ✨ 新增多案例管理
- ✨ 新增自动原点-终点连线生成
- ✨ 新增原点选择对话框
- ✨ 新增案例选择对话框
- 🔧 优化"加原点"和"加终点"按钮逻辑
- 🔧 改进UI按钮显示（使用emoji）

### 未来计划：
- 📋 支持在MapScreen中创建新案例
- 🎨 支持多彩连线和样式定制
- 🎯 连线点击事件和详情显示
- 📊 连线统计和风水分析
- 🗺️ KML导出功能
